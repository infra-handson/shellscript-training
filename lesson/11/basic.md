# 【演習-11】バックグランド処理・フォアグランド処理を試す

## 目的

- バックグラウンド実行、フォアグラウンド実行の状況を観測し、それぞれの稼働状態のイメージをつける。
- 以下のコマンドの使い方を理解する。
    - jobs
    - kill
    - fg
    - bg

## Step1

- 以下の作業は全て`~/shellscript-training/lesson/11`配下にて実施します。対象ディレクトリに移動します。

```bash
cd ~/shellscript-training/lesson/11
```

- 以下の処理を行うシェルスクリプトのファイル(lesson_11_1.sh)を`artifacts`に作成します。  
   - 繰り返しループを書いて、5秒ごとにloop.txtに"loop"と追記出力するコードを実装します。
- 該当のスクリプトをバックグラウンドで実行させます。
    - 実行後、バックグラウンドで実行されていることおよびジョブ番号を確認します。

### 回答・解説

<details>
<summary>回答・解説</summary>
<div>

- 以下の内容でlesson_11_1.shを作成します。

```bash
#!/bin/bash
DIRECTORY=~/shellscript-training/lesson/11/artifacts
while true
do
  echo "loop" >> ${DIRECTORY}/loop.txt
  sleep 5
done
```

- バックグラウンド実行は以下のように`&`をつけて実行します。

```
bash ./artifacts/lesson_11_1.sh &
```

```
jobs
```

- `jobs`コマンド実行例

```
[1]+  Running                 bash artifacts/lesson_11_1.sh &
```

</div>
</details>

## Step2

- Step1で実行したシェルスクリプトに関して以下を順に行います。
    - Step1でバックグラウンド実行したシェルスクリプトが存在しているので、フォアグラウンド実行に切り替えます。
    - その後、フォアグラウンド実行している処理を、ターミナル上で`ctrl + c`とキーボードで押して停止します。
    - 次に、シェルスクリプトをフォアグラウンド実行してからバックグラウンド実行に切り替えます。
    - その後、バックグラウンド実行している処理をkillコマンドを使って停止してみます。

### 回答・解説

<details>
<summary>回答・解説</summary>
<div>

- 自身のターミナルで以下の`jobs`コマンドを実行します。

```
jobs
```

- 自身のターミナルで以下の`fg`コマンドを実行し1番のバックグランドジョブをフォアグランドに引き戻します。

```
fg 1
```

- すると、ループ処理を行うlesson_11_1.shがフォアグランドに戻ってくるのでターミナル上で`ctrl + c`とキーボード入力し、スクリプトを停止させます。
- 再度`jobs`コマンドを実行し、何も表示されていないことを確認します。
- 次に、lesson_11_1.shをフォアグランドで実行します。

```
bash ./artifacts/lesson_11_1.sh
```

- `&`をつけずに実行していることに注意してください。
- 5秒ごとにloop.txtに"loop"が追記されていることをエディタでloop.txtを開いて確認します。
- `ctrl + z`とキーボード入力し、ジョブを一時停止します。
- `jobs`コマンドを実行して、一時停止になっていることとジョブ番号を確認します。

```
jobs
```

- `jobs`コマンド実行例

```
[1]+  Stopped                 bash artifacts/lesson_11_1.sh
```

- bgコマンドを実行して一時停止しているジョブをバックグラウンド実行します。

```
bg 1
```

- 再度`jobs`コマンドを実行しバックグラウンド実行されていることを確認します。loop.txtにも追記されていることを確認します。
- 以上の確認が取れたらkillコマンドを実行し、バックグランドで実行しているシェルスクリプトを停止します。

```
kill %1
```

</div>
</details>

以上。

---

[演習-12のページへ](../12/basic.md)