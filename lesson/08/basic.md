# 【演習-08】ここまでのテクニックを使った組み合わせ演習1

## 目的

- 変数、四則演算、条件分岐を適時柔軟に活用できる。

## Step1

- 以下の作業は全て`~/shellscript-training/lesson/08`配下にて実施します。対象ディレクトリに移動します。

```bash
cd ~/shellscript-training/lesson/08
```

- 以下の処理を行うシェルスクリプトのファイル(lesson_08_1.sh)を`artifacts`に作成します。  
  - シェルスクリプト実行時に1つ目の引数として5,2つ目の引数として8を渡します。
  - 引数に関して以下の2つの条件の判定を行い、結果に応じて処理を分岐します。
    - 条件1
      - 渡された引数の数が2個であるかを判定する。
        - 2個である場合…2つ目の条件の判定処理に移る。
        - 2個でない場合…"引数指定不備"とターミナル上に出力して処理を終了する。
    - 条件2
      - 引数の値が5,8であるかを判定する。
        - 5,8である場合…引数を足し合わせて結果をターミナル上に出力する。
        - 5,8でない場合…"引数指定不備"とターミナル上に出力して処理を終了する。
- 動作確認の条件を整理し、動作確認を実施します。

<details>
<summary>ヒント</summary>
<div>

- 特殊変数を利用することでシェルスクリプト内で引数を参照できます。
- 例えば、コマンド`bash lesson_08_1.sh 5 8`という形式で実行されたシェルスクリプトの場合、特殊変数`$#`、`$1`、`$2`をechoなどで出力してみると、それぞれ`2`、`5`、`8`という値が確認できます。
- 複数条件が真である場合に処理を行いたい場合、下記のように記述することができます。
    - "条件式1 -a 条件式2"の指定方法を利用します。

``` sh
[ $# -eq 2 -a $1 -eq 5 -a $2 -eq 8 ]
```

- またはメタキャラクタ"&&"を利用することも可能です。

``` sh
[ $# -eq 2 ] && [ $1 -eq 5 ] && [ $2 -eq 8 ]
```

- なお、上記２つの指定方法は次のように混ざっていても構いません。

``` sh
[ $# -eq 2 ] && [ $1 -eq 5 -a $2 -eq 8 ]
```

</div>
</details>

### 解答・解説

<details>
<summary>解答・解説</summary>
<div>

- 以下の内容でlesson_08_1.shを作成します。

```bash
#!/bin/bash
if [ $# -eq 2 ] && [ $1 -eq 5 ] && [ $2 -eq 8 ]; then # または if [ $# -eq 2 -a $1 -eq 5 -a $2 -eq 8 ]; then
  echo $(($1 + $2))
else
  echo "引数指定不備"
fi
```

- 動作確認のケースとしては以下のような内容が確認できていると良いでしょう。
    1. 引数に何も渡さない場合 ... NG
    1. 引数に1個だけ適当な値を渡す場合 ... NG
    1. 引数に2個渡すが5、8以外の値を渡す場合 ... NG
    1. 第1引数に5を渡すが、第2引数に8以外の値を渡す場合 ... NG
    1. 第1引数に5以外を渡し、第2引数に8を渡す場合 ... NG
    1. 第1引数に5を渡し、第2引数に8を渡す場合 ... OK(13が返る)

</div>
</details>

## Step2

- Step1の条件2を以下の通り変更した場合のシェルスクリプト(lesson_08_2.sh)を`artifacts`に作成します。(lesson_08_1.shを複製して作成しても良い。)
- 渡された引数が数字であるかを判定します。
    - 数字である場合…引数を足し合わせて結果をターミナル上に出力する。(Step1の問題とは異なり5および8でなくても良い。)
    - 数字でない場合…"引数指定不備"とターミナル上に出力して処理を終了する。
- 動作確認の条件を整理し、動作確認を実施します。

### 解答・解説

<details>
<summary>解答・解説</summary>
<div>

- 以下の内容でlesson_08_2.shを作成します。

```bash
#!/bin/bash
expr $1 + $2 > /dev/null 2>&1 # 計算処理を行いエラー結果は出力しない
RET=$? # exprの終了ステータスを代入する。計算結果が0以外の場合0が、計算結果が0の場合は1が代入される。

if [ $# -eq 2 ] && [ $RET -eq 0 ] || [ $RET -eq 1 ]; then
  echo $(($1 + $2))
else
  echo "引数指定不備"
fi
```

- exprコマンドを用いて計算処理させた場合の終了ステータスを利用することで式に導入した変数が正しく数値で処理できたかどうかの判定ができます。
    - 計算が正しく行えて結果が0以外の時: 0
    - 計算が正しく行えて結果が0の時: 1
    - 計算が正しく行えなかった時: 2
- この結果が返ってくるという仕様を活用し、0もしくは1の場合に計算結果を返し、それ以外は引数指定不備でNGとしています。
- `||`の記述は、異常終了時のみ後続のコマンドを実行するという動きになるため、複数の条件のどちらかが真であれば条件としてクリアになります。

- この時の動作確認のケースとしては以下が考えられます。
    1. 引数に何も渡さない場合 ... NG
    1. 引数に1個だけ適当な数値を渡す場合 ... NG
    1. 引数に2個渡すがいずれも文字列を渡す場合 ... NG
    1. 第1引数に数値を渡すが、第2引数に文字列を渡す場合 ... NG
    1. 第1引数に文字列を渡し、第2引数に数値を渡す場合 ... NG
    1. 第1引数に数値を渡し、第2引数にも数値を渡す場合 ... OK(合計値が返る)
    1. 第1引数、第2引数に0を渡す場合 ... OK(合計値0が返る)

</div>
</details>

以上。

## Advanced

- 時間の余裕があれば以下の情報も確認してみましょう。
- [Advanced](./advanced.md)

---

[演習-09のページへ](../09/basic.md)
