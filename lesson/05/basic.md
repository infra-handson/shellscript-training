# 【演習-05】ループ処理を行うスクリプト作成

## 目的

- ループ処理の書き方を知る。
- ループ処理により効率よく大量の処理を実行するイメージをつける。
- 以下のコマンドの使い方を理解する。
    - for
    - while
    - break

## Step1

- 以下の作業は全て`~/shellscript-training/lesson/05`配下にて実施します。対象ディレクトリに移動します。

```bash
cd ~/shellscript-training/lesson/05
```

- 以下の内容を実現するシェルスクリプトのファイル(lesson_05_1.sh)を`artifacats`に作成します。
  - for文を用いて5回ループする処理を作成し、ループごとにターミナル上にループ回数を出力します。
- スクリプトを実行し、以下の出力結果になることを確認します。

```
1
2
3
4
5
```

### 解答・解説

<details>
<summary>解答・解説</summary>
<div>

- 以下の内容でlesson_05_1.shを作成します。

```bash
#!/bin/bash

for ((i=1; i<=5; i++))
do
  echo $i
done
```

- forループを用いて、iという変数に初期値1を設定し、ループを開始します。
- iに1を加算し、iが5以下であればループ処理を継続します。

</div>
</details>

## Step2

- 以下の内容を実現するシェルスクリプトのファイル(lesson_05_2.sh)を`artifacts`に作成します。
  - while文を用いて無限ループを作成し、3秒ごとに"loop"とターミナル上に出力します。
- スクリプトを実行し、想定通り3秒ごとに出力されるかを確認します。
    - 停止する際はターミナル上で`ctrl + c`とキーボードで押して停止します。

### 解答・解説

<details>
<summary>解答・解説</summary>
<div>

- 以下の内容でlesson_05_2.shを作成します。

```bash
#!/bin/bash

while true
do
  echo "loop"
  sleep 3
done
```

- `while true do 処理 done`
    - 繰り返し無限ループの記法の一つです。
    - `while 条件式`の記載で条件式が真の間は`do 処理 done`内の処理を繰り返し、偽になると繰り返し処理を終了する書き方です。
    - このシェルスクリプトでは`while true`となっており、条件式が常に真となるため無限ループとなります。
  - `sleep 時間`…　指定した時間だけ次のコマンド実行を止めます。

</div>
</details>

## Step3

- 以下の内容を実現するシェルスクリプトのファイル(lesson_05_3.sh)を`artifacts`に作成します。
 - "hoge.txt"が存在するかを判定します。
   - 判定結果により以下の処理が行われます。
     - "hoge.txt"が存在する場合…"OK"とターミナル上に文字を表示して処理を終了します。
     - "hoge.txt"が存在しない場合…"NG"とターミナル上に文字を表示して3秒後に再び同じ判定を行います。
   - ※hoge.txtはシェルスクリプトと同じディレクトリ上に作成します。ファイルの存在確認の用途で利用するため"hoge.txt"の中身は空で構いません。
- 作成されたスクリプトを実行し、まずはNGが3秒ごとに表示されることを確認します。
    - その後、`artifacts`ディレクトリ下にhoge.txtを作成し、OKの表示に変わることを確認します。

<details>
<summary>ヒント</summary>
<div>

- 演習-04で実施した条件判定を参考に処理を書きます。
- ファイルの存在確認の結果を元にループ処理を継続するか、終了するかの判定を行います。
- ループ処理の終了には`break`コマンドが使用できます。

</div>
</details>

### 解答・解説

<details>
<summary>解答・解説</summary>
<div>

- 以下の内容でlesson_05_3.shを作成します。

```bash
#!/bin/bash

FILE="hoge.txt"

while true
do
  if [ -f ${FILE} ]; then
    echo "OK"
    break
  else
    echo "NG"
    sleep 3
  fi
done
```

- Step2で実行と同様、`while true`で無限ループの状態を作ります。
- if文で`-f ファイル名`を評価条件にすることが該当のファイルが存在していれば真、存在していなければ偽とします。
- ファイルの存在が確認できた時のみ、`break`によりループ処理から抜けて完了します。

</div>
</details>

以上。

## Advanced

- 時間の余裕があれば以下の情報も確認してみましょう。
- [Advanced](./advanced.md)

---

[演習-06のページへ](../06/basic.md)

